<script src="__PUBLIC__/extress/install/js/jquery.js"></script>
<script src="__PUBLIC__/extress/install/js/validate.js"></script>
<script src="__PUBLIC__/extress/install/js/ajaxForm.js"></script>
<style>
    .form-bordered .form-label{border-right: none;}
</style>
     <div class="example-box">
         <div id="form-wizard" class="form-wizard">
             <ul class="anchor">
            <li>
                <a href="/install.php" class="selected" isdone="1" rel="1">
                  <label class="wizard-step">1</label>
                  <span class="wizard-description">
                     阅读协议
                  </span>
                </a>
            </li>
            <li>
                <a href="{:U('step2')}" class="selected" isdone="0" rel="2">
                  <label class="wizard-step">2</label>
                  <span class="wizard-description">
                     检测环境
                  </span>
                </a>
            </li>
            <li>
                <a href="{:U('step2')}" class="selected" isdone="0" rel="3">
                  <label class="wizard-step">3</label>
                  <span class="wizard-description">
                    参数配置
                  </span>                   
                </a>
            </li>
            <li>
                <a href="#step-4" class="disabled" isdone="0" rel="4">
                  <label class="wizard-step">4</label>
                  <span class="wizard-description">
                     安装进行
                  </span>                   
                </a>
            </li>
               <li>
                <a href="#step-5" class="disabled" isdone="0" rel="4">
                  <label class="wizard-step">5</label>
                  <span class="wizard-description">
                     完成安装
                  </span>                   
                </a>
            </li>
          </ul>
         </div>
     </div>

 
 <div class="example-box">
    <div class="example-code clearfix">
        <div class='row col-md-12 '> 
        <form class="form-bordered" id="J_install_form" action="{:U('step4')}" method="post">
            <div class='form-row'>
                <div class="form-input col-md-10">
                            <h4 class=''>数据库配置</h4>
                </div>
            </div>
            <div class="form-row">
                <div class="form-label col-md-2">
                    <label for="">
                       数据库服务器:
                    </label>
                </div>
                <div class="form-input col-md-10">
                    <input type="text" id="dbhost" class="input" name="dbhost" value="127.0.0.1"/> 
                    <ul id="J_install_tip_dbhost" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;">数据库服务器地址，一般为127.0.0.1</li>
                    </ul>
                   
                </div>
            </div>
            <div class="form-row">
                <div class="form-label col-md-2">
                    <label for="">
                        数据库端口:
                    </label>
                </div>
                <div class="form-input col-md-10">
                    <input type="text" name="dbport" id="dbport" class="input" value="3306"/>
                      <ul id="J_install_tip_dbport" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;">数据库服务器端口，一般为3306</li>
                    </ul>
                </div>
            </div>
            <div class="form-row">
                <div class="form-label col-md-2">
                    <label for="">
                       数据库用户名:
                    </label>
                </div>
                <div class="form-input col-md-10">
                    <input type="text" name="dbuser" id="dbuser" class="input" value="root" >
                     <ul id="J_install_tip_dbuser" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;"></li>
                    </ul>
                </div>
            </div>
            <div class="form-row ">
                <div class="form-label col-md-2">
                    <label for="">
                        数据库密码:
                    </label>
                </div>
                <div class="form-input col-md-10">
                   <input type="password" name="dbpwd" id="dbpwd" class="input" autoComplete="off" onblur="condb()" />
                    <ul id="J_install_tip_dbpwd" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;"></li>
                    </ul>
                </div>
            </div>
             <div class="form-row ">
                <div class="form-label col-md-2">
                    <label for="">
                        数据库名:
                    </label>
                </div>
                <div class="form-input col-md-10">
                 <input type="text" name="dbname" id="dbname" class="input"/> 
                 <ul id="J_install_tip_dbname" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;"></li>
                    </ul>
                </div>
            </div>
                <div class="form-row ">
                <div class="form-label col-md-2">
                    <label for="">
                        数据表前缀:
                    </label>
                </div>
                <div class="form-input col-md-10">
                   <input type="text" name="dbprefix" id="dbprefix" class="input" value="chou_"/> 
                     <ul id="J_install_tip_dbprefix" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;">建议使用默认，同一数据库安装多个Sikcms时需修改</li>
                    </ul>
                </div>
            </div>
             <div class='form-row'>
                <div class="form-input col-md-10">
                            <h4 class=''>网站描述</h4>
                </div>
            </div>
             <div class="form-row ">
                <div class="form-label col-md-2">
                    <label for="">
                        网站名称：
                    </label>
                </div>
                <div class="form-input col-md-10">
                  <input type="text" id="sitename" class="input" name="sitename" value="思科CMS内容管理系统"/>
                   <ul id="J_install_tip_sitename" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;"></li>
                    </ul>
                </div>
            </div>
             <div class="form-row ">
                <div class="form-label col-md-2">
                    <label for="">
                        网站域名:
                    </label>
                </div>
                <div class="form-input col-md-10">
                  <input type="text" id="siteurl" class="input" name="siteurl" value="{$parse_url.path}"/> 
                   <ul id="J_install_tip_siteurl" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;">请以“/”结尾</li>
                    </ul>
                </div>
            </div>
             <div class="form-row ">
                <div class="form-label col-md-2">
                    <label for="">
                        关键词:
                    </label>
                </div>
                <div class="form-input col-md-10">
                 <input type="text" id="sitekeywords" class="input" name="sitekeywords" value=""/>
                  <ul id="J_install_tip_sitekeywords" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;">请以“/”结尾</li>
                    </ul>
                </div>
            </div>
             <div class="form-row ">
                <div class="form-label col-md-2">
                    <label for="">
                        描述:
                    </label>
                </div>
                <div class="form-input col-md-10">
                  <input type="text" id="siteinfo" class="input" name="siteinfo" value="Sikcms后台管理系统,是一款完全开源免费的PHP+MYSQL系统.核心采用了Thinkphp框架等众多开源软件,同时核心功能也作为开源软件发布"/>
                  
                   <ul id="J_install_tip_siteinfo" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;"></li>
                    </ul>
                </div>
            </div>
              <div class='form-row'>
                <div class="form-input col-md-10">
                            <h4 class=''>管理员信息</h4>
                </div>
            </div> 
               <div class="form-row ">
                <div class="form-label col-md-2">
                    <label for="">
                        管理员账号:
                    </label>
                </div>
                <div class="form-input col-md-10">
                <input type="text" class="input" name="manager" value="admin"/> 
                <ul id="J_install_tip_admin" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;"></li>
                    </ul>
                </div>
            </div>
               <div class="form-row ">
                <div class="form-label col-md-2">
                    <label for="">
                        管理员密码:
                    </label>
                </div>
                <div class="form-input col-md-10">
               <input type="text" class="input" id="J_manager_pwd" name="manager_pwd" autoComplete="off" />
                <ul id="J_install_tip_manager_pwd" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;"></li>
                    </ul>
                </div>
            </div>
               <div class="form-row ">
                <div class="form-label col-md-2">
                    <label for="">
                        重复密码:
                    </label>
                </div>
                <div class="form-input col-md-10">
                <input type="text" class="input" name="manager_ckpwd" autoComplete="off" /> 
                  <ul id="J_install_tip_manager_ckpwd" class="parsley-error-list" style="display: block;">
                      <li class="required" style="display: list-item;"></li>
                    </ul>
                </div>
            </div>
             <div class="form-row ">
                <div class="form-label col-md-2">
                    <label for="">
                        Email:
                    </label>
                </div>
                <div class="form-input col-md-10">
                <input type="text" class="input" name="manager_email" /> 
                </div>
            </div>
             <div class="form-row">
                      <div class="form-input col-md-11">
                          <div class='form-checkbox-radio col-md-10'>
                             <input name="testdata" value="1" alt="测试数据需要安装在根目录下才可以完整体验-__,-!" title="测试数据需要安装在根目录下才可以完整体验-__,-!" type="checkbox">
                              <label for="">默认测试数据</label>
                          </div>
                      </div>
                 </div>

                       <div class="form-row">
                           <div class="form-input col-md-10 col-md-offset-2">
                               <button class="btn ui-state-default medium" onclick="history.go(-1)">
                                  <span class="button-content">后退</span>
                               </button>
                                <button class="btn primary-bg medium btn-next btn_submit J_install_btn" >
                                    <span class="button-content" >创建数据</span>
                                 </button>

                               </div>
                       </div>
              
        </form>

    </div>
       
</div> 
</div>



<script>
    function condb(){
        var dbHost =$('#dbhost').val();
        var dbUser = $('#dbuser').val();
        var dbPwd = $('#dbpwd').val();
        var dbName = $('#dbname').val();
        var dbPort = $('#dbport').val();
        data = {'dbHost':dbHost,'dbUser':dbUser,'dbPwd':dbPwd,'dbName':dbName,'dbPort':dbPort};
        var url = "{:U('condb')}";
        $.ajax({
            type:"POST",
            url:url,
            data:data,
            beforeSend:function(){
            },
            success:function(msg){
                if(msg){}else{
                    $("#dbpw").val("");
                     $('#J_install_tip_dbpwd').html('<span for="dbname" generated="true" class="tips_error" style="">数据库链接配置失败</span>');
                }
            },
            complete:function(){},
            error:function(){
                $('#J_install_tip_dbpwd').html('<span for="dbname" generated="true" class="tips_error" style="">数据库链接配置失败</span>');
                $('#dbpw').val("");
            }
        });
    }
    $(function(){
      //聚焦时默认提示
      var focus_tips = {
          dbhost :'数据库服务器地址，一般为127.0.0.1',
          dbport:'数据库服务器端口，一般为3306',
          dbuser:'',
          dbpwd:'',
          dbname:'',
          dbprefix:'建议使用默认，同一数据库安装多个时需修改',
          manager:'创始人帐号，拥有站点后台所有管理权限',
          manager_pwd:'',
          manager_ckpwd:'',
          sitename:'',
          siteurl:'请以“/”结尾',
          sitekeywords:'',
          siteinfo:'',
          manager_email:''
      };
      var install_form = $("#J_install_form"),
              reg_username=$('#user_name'),             //用户名表单
              reg_password = $('#J_reg_password'),      //密码表单
              reg_tip_password = $('#J_reg_tip_password'), //密码提示区
              response_tips = $('#J_response_tips');      //后端返回提示

    install_form.validate({
        debug:true,
        errorPlacement:function(error,element){
            //错误提示容器
            $('#J_install_tip_'+element[0].name).html(error);
        },
        errorElement:'span',
        errorClass:'tips_error',
        validClass :'tips_error',
        onkeyup:false,
        focusInvalid:false,
        rules:{
            dbhost:{
                required:true
            },
            dbport:{
                required:true
            },
            dbuser:{
                required:true
            },
            dbpwd:{
                required:true
            },
            dbname:{
                required:true
            },
            dbprefix : {
                required	: true
            },
            manager:{
                required:true
            },
            manager_pwd:{
                required:true
            },
            manager_ckpwd:{
                required:true,
                equalTo:'#J_manager_pwd'
            },
            manager_email:{
                required:true,
                email:true
            }
        },
        highlight:false,
        unhighlight:function(element,errorClass,validClass){
           var tip_elem = $('#J_install_tip_'+element.name);
            tip_elem.html('<span class="'+validClass+'" data-text="text"></span>');
            $(element).parents('tr').addClass('current');
        },
        onfocusout:function(element){
            var _this=this;
            $(element).parents('tr').removeClass('current');
            if(element.name==='email'){
                //邮箱匹配点击后，延时处理
                setTimeout(function(){
                    _this.element(element);
                }, 150);
            }else{
                _this.element(element);
            }
        },
        messages:{
            dbhost: {
                required	: '数据库服务器地址不能为空'
            },
            dbport:{
                required	: '数据库服务器端口不能为空'
            },
            dbuser: {
                required	: '数据库用户名不能为空'
            },
            dbpwd: {
                required	: '数据库密码不能为空'
            },
            dbname: {
                required	: '数据库名不能为空'
            },
            dbprefix : {
                required	: '数据库表前缀不能为空'
            },
            manager: {
                required	: '管理员帐号不能为空'
            },
            manager_pwd: {
                required	: '密码不能为空'
            },
            manager_ckpwd: {
                required	: '重复密码不能为空',
                equalTo : '两次输入的密码不一致。请重新输入'
            },
            manager_email: {
                required	: 'Email不能为空',
                email : '请输入正确的电子邮箱地址'
            }
        },
        submitHandler:function(form) {
            form.submit();
            return true;
        }

    });
        var _data = {};
    });
</script>
